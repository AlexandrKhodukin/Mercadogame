<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MercadoGame - –ú–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å –∏–≥—Ä–æ–≤—ã—Ö –∞–∫–∫–∞—É–Ω—Ç–æ–≤</title>
    <link rel="stylesheet" href="css/main.css">
    <style>
        /* –°–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã */

        /* –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å–µ–∫—Ü–∏–∏ */
        .section-header {
            margin-bottom: 40px;
        }

        /* –°–µ—Ç–∫–∞ –∏–≥—Ä */
        .games-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 25px;
        }

        /* –ö–∞—Ä—Ç–æ—á–∫–∞ –∏–≥—Ä—ã */
        .game-card {
            background: #ffffff;
            border-radius: 12px;
            padding: 0;
            transition: all 0.3s ease;
            cursor: pointer;
            border: 1px solid #e5e7eb;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
        }

        .game-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #ff6b35, #2563eb, #10b981);
            transform: scaleX(0);
            transform-origin: left;
            transition: transform 0.3s ease;
        }

        .game-card:hover::before {
            transform: scaleX(1);
        }

        .game-card:hover {
            transform: translateY(-4px);
            border-color: #cbd5e1;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.08);
        }

        .game-card-content {
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .game-header {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .game-icon {
            width: 70px;
            height: 70px;
            background: linear-gradient(135deg, #ff6b35, #ff8555);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            font-weight: bold;
            color: white;
            flex-shrink: 0;
            box-shadow: 0 2px 8px rgba(255, 107, 53, 0.2);
        }

        .game-info {
            display: flex;
            flex-direction: column;
            gap: 6px;
            flex: 1;
            min-width: 0;
        }

        .game-name {
            font-size: 20px;
            font-weight: 700;
            color: #1f2937;
            line-height: 1.3;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }

        .game-stats {
            font-size: 14px;
            color: #6b7280;
        }

        .game-stats-value {
            color: #ff6b35;
            font-weight: 600;
        }

        .game-tags {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 6px;
            font-size: 11px;
        }

        .game-tag {
            background: #f7f8fa;
            color: #6b7280;
            padding: 8px 10px;
            border-radius: 8px;
            border: 1px solid #e5e7eb;
            cursor: pointer;
            transition: all 0.2s ease;
            text-decoration: none;
            text-align: center;
            font-weight: 600;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 3px;
            justify-content: center;
        }

        .game-tag-icon {
            font-size: 16px;
        }

        .game-tag:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        /* –°–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –∫–∞–∂–¥–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ */
        .game-tag[href*="category=account"] {
            border-color: #d1fae5;
        }

        .game-tag[href*="category=account"]:hover {
            background: #d1fae5;
            color: #059669;
            border-color: #10b981;
        }

        .game-tag[href*="category=service"] {
            border-color: #dbeafe;
        }

        .game-tag[href*="category=service"]:hover {
            background: #dbeafe;
            color: #1d4ed8;
            border-color: #2563eb;
        }

        .game-tag[href*="category=currency"] {
            border-color: #fef3c7;
        }

        .game-tag[href*="category=currency"]:hover {
            background: #fef3c7;
            color: #d97706;
            border-color: #f59e0b;
        }

        .game-tag[href*="category=other"] {
            border-color: #f3e8ff;
        }

        .game-tag[href*="category=other"]:hover {
            background: #f3e8ff;
            color: #7c3aed;
            border-color: #8b5cf6;
        }

        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–ª—è –∫–∞—Ä—Ç–æ—á–µ–∫ –∏–≥—Ä */
        @media (max-width: 1024px) {
            .games-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 20px;
            }
        }

        @media (max-width: 768px) {
            .games-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .game-tags {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }

            .game-tag {
                font-size: 10px;
                padding: 6px 6px;
            }

            .game-tag-icon {
                font-size: 14px;
            }
        }

        @media (max-width: 480px) {
            .game-icon {
                width: 55px;
                height: 55px;
                font-size: 26px;
            }

            .game-name {
                font-size: 17px;
            }

            .game-stats {
                font-size: 12px;
            }

            .game-tag {
                font-size: 9px;
                padding: 5px 6px;
            }

            .game-tag-icon {
                font-size: 13px;
            }
        }

        /* –ü—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫ */
        .empty-state {
            text-align: center;
            padding: 80px 20px;
            grid-column: 1 / -1;
        }
    </style>
</head>
<body>
    <!-- –®–∞–ø–∫–∞ -->
    <header>
        <div class="header-content">
            <a href="index.html" class="logo">
                <img src="images/logo.png" alt="MercadoGame" class="logo-image">
                <span class="logo-text">Mercado<span>Game</span></span>
            </a>
            <div class="header-search">
                <input
                    type="text"
                    class="header-search-input"
                    placeholder="–ü–æ–∏—Å–∫ –ø–æ –∏–≥—Ä–∞–º –∏ –æ–±—ä—è–≤–ª–µ–Ω–∏—è–º..."
                    data-i18n-placeholder="search_placeholder"
                    id="header-search"
                >
            </div>
            <div id="auth-buttons" class="auth-buttons">
                <div class="loading" data-i18n="loading">–ó–∞–≥—Ä—É–∑–∫–∞</div>
            </div>
        </div>
    </header>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
    <div class="container">
        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
        <div class="section-header">
            <h1 class="section-title" data-i18n="games_catalog">–ö–∞—Ç–∞–ª–æ–≥ –∏–≥—Ä</h1>
            <p class="section-subtitle" data-i18n="select_game">–í—ã–±–µ—Ä–∏—Ç–µ –∏–≥—Ä—É –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –æ–±—ä—è–≤–ª–µ–Ω–∏–π</p>
        </div>

        <!-- –°–µ—Ç–∫–∞ –∏–≥—Ä -->
        <div id="games" class="games-grid">
            <div class="loading" data-i18n="loading_games">–ó–∞–≥—Ä—É–∑–∫–∞ –∏–≥—Ä</div>
        </div>
    </div>

    <script src="js/i18n.js"></script>
    <script src="js/notifications.js"></script>
    <script src="js/api.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/search.js"></script>
    <script>
        window.allGames = [];
        window.allListings = [];

        // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–≥—Ä –∏ –æ–±—ä—è–≤–ª–µ–Ω–∏–π
        async function loadGames() {
            try {
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –∏–≥—Ä—ã –∏ –æ–±—ä—è–≤–ª–µ–Ω–∏—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
                const [games, listings] = await Promise.all([
                    API.getGames(),
                    API.getListings()
                ]);

                window.allGames = games;
                window.allListings = listings;

                displayGames(games);
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                document.getElementById('games').innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">‚ö†Ô∏è</div>
                        <div class="empty-text">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–≥—Ä</div>
                    </div>
                `;
            }
        }

        // –ü–æ–¥—Å—á–µ—Ç –æ–±—ä—è–≤–ª–µ–Ω–∏–π –¥–ª—è –∏–≥—Ä—ã
        function getListingsCountForGame(gameId) {
            return window.allListings.filter(listing => listing.game == gameId).length;
        }

        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–≥—Ä
        window.displayGames = function(games) {
            const container = document.getElementById('games');
            container.innerHTML = '';

            if (games.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">üéÆ</div>
                        <div class="empty-text">–ò–≥—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</div>
                    </div>
                `;
                return;
            }

            games.forEach(game => {
                const initials = getInitials(game.name);
                const listingsCount = getListingsCountForGame(game.id);

                const card = document.createElement('div');
                card.className = 'game-card';
                card.innerHTML = `
                    <div class="game-card-content">
                        <div class="game-header">
                            <div class="game-icon">${initials}</div>
                            <div class="game-info">
                                <div class="game-name">${game.name}</div>
                                <div class="game-stats"><span class="game-stats-value">${listingsCount}</span> <span data-i18n="active_listings">–∞–∫—Ç–∏–≤–Ω—ã—Ö –æ–±—ä—è–≤–ª–µ–Ω–∏–π</span></div>
                            </div>
                        </div>
                        <div class="game-tags">
                            <a href="listings.html?game=${game.id}&category=account" class="game-tag">
                                <div class="game-tag-icon">üéÆ</div>
                                <div data-i18n="cat_account">–ê–∫–∫–∞—É–Ω—Ç—ã</div>
                            </a>
                            <a href="listings.html?game=${game.id}&category=currency" class="game-tag">
                                <div class="game-tag-icon">üí∞</div>
                                <div data-i18n="cat_currency">–í–∞–ª—é—Ç–∞</div>
                            </a>
                            <a href="listings.html?game=${game.id}&category=service" class="game-tag">
                                <div class="game-tag-icon">üîß</div>
                                <div data-i18n="cat_service">–£—Å–ª—É–≥–∏</div>
                            </a>
                            <a href="listings.html?game=${game.id}&category=other" class="game-tag">
                                <div class="game-tag-icon">üì¶</div>
                                <div data-i18n="cat_other">–î—Ä—É–≥–æ–µ</div>
                            </a>
                        </div>
                    </div>
                `;

                // –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∏–∫ –Ω–∞ –≤—Å—é –∫–∞—Ä—Ç–æ—á–∫—É
                card.addEventListener('click', (e) => {
                    // –ï—Å–ª–∏ –∫–ª–∏–∫ –±—ã–ª –ø–æ —Ç–µ–≥—É (–∫–∞—Ç–µ–≥–æ—Ä–∏–∏), –Ω–µ –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ–º –µ–≥–æ
                    if (e.target.classList.contains('game-tag')) {
                        return;
                    }
                    // –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –æ–±—ä—è–≤–ª–µ–Ω–∏–π —Å–æ –≤—Å–µ–º–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏
                    window.location.href = `listings.html?game=${game.id}`;
                });

                container.appendChild(card);
            });

            // –ü—Ä–∏–º–µ–Ω—è–µ–º –ø–µ—Ä–µ–≤–æ–¥—ã –∫ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–º —ç–ª–µ–º–µ–Ω—Ç–∞–º
            if (typeof updateTranslations === 'function') {
                updateTranslations();
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        checkAuth();
        
        // –ñ–¥—ë–º –∑–∞–≥—Ä—É–∑–∫–∏ API –ø–µ—Ä–µ–¥ –≤—ã–∑–æ–≤–æ–º loadGames
        if (typeof API !== 'undefined') {
            loadGames();
        } else {
            // –ï—Å–ª–∏ API –µ—â—ë –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω, –∂–¥—ë–º
            window.addEventListener('load', () => {
                loadGames();
            });
        }
    </script>
</body>
</html>